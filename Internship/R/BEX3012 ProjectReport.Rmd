---
title: "BEX3012 Project Report \n Detecting Facial Expressions in Professional Tennis Matches"
author: "Stephanie Kobakian"
date: "28 March 2017"
output: bookdown::pdf_document2
fig_caption: yes
fontsize: 11pt
link-citations: true
---


```{r cache=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = F, warning = F,cache=T)

library(tidyverse)
library(readr)
library(GGally)

#EmoM <-read_csv("data/EmotionsMerged.csv")
ME <- read_csv("../data/MicrosoftEmotions.csv")
SB <- read_csv("../data/SkybiometryEmotions.csv")
GE <- read_csv("../data/GoogleFacesEmotions.csv")

EmotionSoftwareSpecs <- read_csv("../TableCSVs/EmotionSoftwareSpecifications.csv")
ALLmetaIMGnamed <- read_csv("../data/ALLmetaIMGnamed.csv")

#Create normalised SB values
SB<-SB %>%
  rowwise %>% mutate(z = (anger.confidence+
               disgust.confidence+
               fear.confidence+
               happiness.confidence+
               neutral_mood.confidence+
               sadness.confidence+
               surprise.confidence))
 
SB<-SB %>%
  mutate(anger = anger.confidence/z,
         disgust = disgust.confidence/z, 
         fear = fear.confidence/z,
         happiness = happiness.confidence/z,
         neutral = neutral_mood.confidence/z,
         sadness = sadness.confidence/z,
         surprise = surprise.confidence/z)

```


# Introduction

Facial Recognition is beginning to be explored in sports environments, this presents quality issues.


helpful for applications



# Method
## Materials
### Pre Processing Images
A subset of faces was created specifically for emotion recognition purposes.
To present only a single face to each software required cropping the region of the image based on Google's bounding box result^[coordinates taken from prior study]

Each new image created contained the area within the face bounding boxes found in the previous study, as well as a small border to frame the face. This resulted in images of differing sizes to be passed to the APIs.
These 1319 new images were hosted on Google Drive to allow for URL access from the API to the individual images.

### Software APIs

We will consider three Emotion Recognition softwares.


```{r Emotion-Software-Specs-Table, echo=F, fig.cap = "\\label{tab:Emotion-Software-Specs-Table}"}

knitr::kable(EmotionSoftwareSpecs, longtable=TRUE, booktabs = TRUE, caption="This details the capabilities we considered important in recognising emotions in images of faces.")
```


As can be seen above, a noticable difference between the three is the amount of times the API can be called. Skybiometry had the largest imposition on Batch Processing as it only allowed 100 API calls to be processed per hour. Microsoft also had a limit imposed, but this allowed for much more to be processed with the possibility of 1200 images to be processed within an hour, after accounting for the wait time per minute.
Google Vision's API batch processing limit had a minimal effect.


The range of outputs from the softwares is displayed as Google provides likelihoods of an emotion occuring on a particular face. Microsoft and Skybiometry provide outputs on the same emotions^[Based on Paul Ekmans emotion theories]. However the values that they provide differ as Microsoft provide Porportions whereas Skybiometry results in a Confidence of the emotion occuring in the specified face.


### Preprocessing of API results

#### Microsoft 

```{r MEexample, echo=F, fig.cap = "\\label{tab:MEexample}"}
knitr::kable(ME[25,2:9], digits=6, longtable=TRUE, booktabs = TRUE, caption="The Microsoft API provided 8 numerical values.")
```

These numeric values approximately summed to a value of 1, there was no indication of how these categories were calculated.


#### Skybiometry

```{r SBexample, echo=F, message=F, fig.cap = "\\label{tab:SBexample}"}
library(dplyr)
SBexample <- SB %>% filter(aname=="face-1745-1-Go.png") %>%  select(ends_with(".confidence")) 


knitr::kable(SBexample[,3:9], digits=6, longtable=TRUE, booktabs = TRUE, col.names = c("neutral", "anger", "disgust",
          "fear", "happiness", "sadness", "surprise"),
             caption="The Skybiometry API provided 7 numerical Confidence values.")

```



#### Google

```{r GEexample, echo=F, message=F, fig.cap = "\\label{tab:GEexample}"}

GEexample <- GE %>% subset(FileName=="face-1745-1-Go.png")


knitr::kable(GEexample, col.names = c("joy", "sorrow", "anger", "surprise"), caption="The Google API provided 4 categorical Likelihoods.")

```





# Analysis
# Within Software Variation

Microsoft:

```{r}


```






